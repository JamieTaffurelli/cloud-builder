name: 'Terraform'

on:
  push:
    branches:
      - master

jobs:
  config:
    name: 'Push to storage'
    runs-on: ubuntu-latest
    environment: production
    defaults:
      run:
        shell: bash

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Login
      run: az login --service-principal -u "b390c3f2-b87d-4a01-8840-71db946d47f0" -p "b390c3f2-b87d-4a01-8840-71db946d47f0" --tenant "39133f74-b0c2-4b65-ac2d-5900ee40a76c"


    - name: Login
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    
    - name: Upload to blob storage
      uses: azure/CLI@v1
      with:
        inlineScript: |
            az storage blob upload-batch --account-name configsajdn --auth-mode login --destination '$scripts' --source ./azure/scripts

    - name: logout
      run: |
            az logout
      if: always()